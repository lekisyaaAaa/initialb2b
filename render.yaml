# Render manifest for BeanToBin environmental monitoring system
# This manifest creates:
#  - a Node web service for the backend (beantobin-backend)
#  - a background worker for the sensor poller (beantobin-poller)
#  - a static site service for the frontend build (beantobin-frontend)
#  - a managed PostgreSQL database (beantobin-db)
#
# After connecting your repository on Render, configure the backend service's
# environment variables (DATABASE_URL, JWT_SECRET, TWILIO credentials if used).

services:
  - type: web
    name: beantobin-backend
    env: node
    branch: fix/contact-header-gap
    plan: starter
    buildCommand: cd backend && npm ci
    startCommand: cd backend && npm run start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: '5000'
    healthCheckPath: /api/health

  - type: worker
    name: beantobin-poller
    env: node
    branch: fix/contact-header-gap
    plan: starter
    buildCommand: cd backend && npm ci
    startCommand: cd backend && node services/sensor-poller-ha.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: RUN_POLLER
        value: 'true'

  - type: static
    name: beantobin-frontend
    branch: fix/contact-header-gap
    plan: starter
    buildCommand: cd frontend && npm ci && npm run build
    publishPath: frontend/build

databases:
  - name: beantobin-db
    plan: starter
    version: '14'

# IMPORTANT: After Render creates the database, set the following environment
# variables for the backend service in the Render dashboard:
#
# - DATABASE_URL: (provided by Render or copy from DB settings)
# - JWT_SECRET: a long random secret used for signing JWTs
# - TWILIO_SID / TWILIO_TOKEN / TWILIO_FROM: (if using SMS alerts)
#
# You can also set the following optional vars:
# - PGSSLMODE=require (if you want SSL on Postgres connection)
# - RUN_POLLER=true (if you prefer inline poller instead of worker)
# Render deployment manifest for BeanToBin environmental monitoring system
#
# This file defines a managed Postgres database and a Node web service for the
# backend. It is intended to be used with Render (https://render.com). When you
# connect this repository to Render, Render will read this file and create the
# specified services. After deployment you must provide runtime secrets in the
# Render dashboard (see instructions in CLONE_SETUP_GUIDE.md below).

services:
  - type: web
    name: beantobin-backend
    env: node
    # Optional: change the branch if you want a different branch deployed
    branch: fix/contact-header-gap
    plan: starter
    buildCommand: cd backend && npm ci
    startCommand: cd backend && npm run start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: '5000'
    # Health check path Render will use to verify the service
    healthCheckPath: /api/health

  - type: worker
    name: beantobin-poller
    env: node
    branch: fix/contact-header-gap
    plan: starter
    buildCommand: cd backend && npm ci
    startCommand: cd backend && node services/sensor-poller-ha.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: RUN_POLLER
        value: 'true'

databases:
  - name: beantobin-db
    # Starter plan is the free/development tier on Render; choose a paid plan for
    # production usage.
    plan: starter
    # PostgreSQL major version to use (optional)
    version: '14'

# Notes:
# 1. When the managed database is created by Render it will automatically
#    provide a connection URL to services created in the same Render account.
#    The environment variable is usually `DATABASE_URL` and will be available
#    to your backend service. If you create the database manually via the UI
#    instead, copy the DB connection string to the backend service's
#    environment variables (DATABASE_URL or PGHOST/PGUSER/PGPASSWORD/PGDATABASE/PGPORT).
## Render service manifest
# Import this repository into Render and use this manifest to create the services.
# After import, set JWT_SECRET and any secrets in the Render dashboard.

databases:
  - name: initialb2b-db
    plan: starter

services:
  - type: web
    name: initialb2b-backend
    env: docker
    dockerfilePath: backend/Dockerfile
    branch: fix/contact-header-gap
    plan: free
    startCommand: "node server.js"
    env:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "5000"
      # NOTE: Set JWT_SECRET and DATABASE_URL in the Render dashboard instead of hardcoding here.

  - type: static
    name: initialb2b-frontend
    branch: fix/contact-header-gap
    buildCommand: "npm ci && npm run build"
    publishPath: build
    plan: free

# After creating the database, Render will provide a DATABASE_URL. In the backend service's
# environment variables set DATABASE_URL to that value. Also add JWT_SECRET (a long random
# string). Set any other secrets (e.g., TWILIO creds) as needed.
