schemaVersion: "1"
# Render manifest for BeanToBin environmental monitoring system
#
# This manifest provisions:
#   - A Node web service for the backend API
#   - An optional Node worker for the high-availability sensor poller
#   - A static site service for the React frontend build
#   - A managed PostgreSQL database
#
# After importing into Render, set all secrets (DATABASE_URL, JWT_SECRET, SMTP, TWILIO, etc.)
# in the Render dashboard. Never commit real secrets to this repository.

services:
  - type: web
    name: beantobin-backend
    env: node
    plan: starter
    branch: main
    buildCommand: cd backend && npm ci
    startCommand: cd backend && npm run start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: '5000'
      # Configure the following in the Render dashboard after the service is created:
      # - DATABASE_URL (from the managed Postgres instance)
      # - JWT_SECRET (long random value)
      # - SMTP_* / TWILIO_* credentials (if used)
      # - CORS_ORIGINS / SOCKETIO_CORS_ORIGINS

  - type: worker
    name: beantobin-poller
    env: node
    plan: starter
    branch: main
    buildCommand: cd backend && npm ci
    startCommand: cd backend && node services/sensor-poller-ha.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: RUN_POLLER
        value: 'true'
      # Provide the same DATABASE_URL / JWT_SECRET / SMTP / TWILIO vars via the dashboard.

  - type: static
    name: beantobin-frontend
    env: static
    branch: main
    buildCommand: cd frontend && npm ci && npm run build
    staticPublishPath: frontend/build
    envVars:
      - key: NODE_ENV
        value: production
      # Configure REACT_APP_* variables in the dashboard if frontend runtime config is needed.

databases:
  - name: beantobin-db
    plan: starter
    region: oregon
    databaseName: beantobin
    user: beantobin_admin
    version: '14'
    # Render will expose DATABASE_URL once the database is provisioned.
# Render deployment manifest for BeanToBin environmental monitoring system
