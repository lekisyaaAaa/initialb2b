#!/bin/sh
# Prevent committing environment files (.env) into the repository.
# Usage: enable with `git config core.hooksPath .githooks` (repo-local)

# Check staged files for .env patterns
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
if [ -n "$STAGED_FILES" ]; then
  for f in $STAGED_FILES; do
    case "$f" in
      .env|*.env|backend/.env|frontend/.env)
        echo "ERROR: Attempt to commit an environment file: $f"
        echo "Please remove this file from the commit and use .env.example or repository secrets instead."
        exit 1
        ;;
    esac
  done
fi

# Also fail if the repo already contains tracked .env files in HEAD
for f in ".env" "backend/.env" "frontend/.env"; do
  if git ls-files --error-unmatch "$f" > /dev/null 2>&1; then
    echo "ERROR: Repository contains tracked environment file: $f"
    echo "Remove it from the repository and add it to .gitignore; use .env.example instead."
    exit 1
  fi
done

exit 0
