# ESPHome Configuration for Environmental Monitoring
# Copy this to your ESPHome dashboard and customize for your sensors

esphome:
  name: beantobin-greenhouse-01
  platform: ESP32
  board: esp32dev

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

# Enable logging
logger:
  level: INFO

# Enable Home Assistant API
api:
  password: !secret api_password

# Enable OTA updates
ota:
  password: !secret ota_password

# Web server for device status
web_server:
  port: 80

# Sensors configuration
sensor:
  # DHT22 Temperature & Humidity Sensor
  - platform: dht
    pin: GPIO4
    model: DHT22
    temperature:
      name: "Greenhouse Temperature"
      accuracy_decimals: 1
    humidity:
      name: "Greenhouse Humidity"
      accuracy_decimals: 1
    update_interval: 30s

  # Soil Moisture Sensor (Analog)
  - platform: adc
    pin: GPIO34
    name: "Soil Moisture"
    unit_of_measurement: "%"
    accuracy_decimals: 1
    update_interval: 30s
    filters:
      - calibrate_linear:
          # Map ADC values to percentage (adjust these values for your sensor)
          - 0.0 -> 0.0
          - 3.3 -> 100.0

  # pH Sensor (Analog)
  - platform: adc
    pin: GPIO35
    name: "Soil pH"
    unit_of_measurement: "pH"
    accuracy_decimals: 2
    update_interval: 30s
    filters:
      - calibrate_linear:
          # Map ADC values to pH range (adjust for your sensor calibration)
          - 0.0 -> 0.0
          - 3.3 -> 14.0

  # Optional: EC/TDS Sensor
  - platform: adc
    pin: GPIO32
    name: "EC Value"
    unit_of_measurement: "ÂµS/cm"
    accuracy_decimals: 0
    update_interval: 30s

  # Battery voltage monitoring (if using battery)
  - platform: adc
    pin: GPIO33
    name: "Battery Voltage"
    unit_of_measurement: "V"
    accuracy_decimals: 2
    update_interval: 300s  # Less frequent for battery
    filters:
      - multiply: 2.0  # Voltage divider ratio

# Binary sensors (optional)
binary_sensor:
  # Water level sensor
  - platform: gpio
    pin:
      number: GPIO25
      mode: INPUT_PULLUP
    name: "Water Level Low"
    device_class: moisture

# Switches for actuators (optional)
switch:
  - platform: gpio
    pin: GPIO26
    name: "Water Pump"
    id: water_pump

  - platform: gpio
    pin: GPIO27
    name: "Fan"
    id: cooling_fan

# Status LED
light:
  - platform: monochromatic
    output: status_led
    name: "Status LED"
    id: status_led

output:
  - platform: ledc
    pin: GPIO2
    id: status_led_output

# Automations (optional)
interval:
  - interval: 5min
    then:
      - light.turn_on: status_led
      - delay: 100ms
      - light.turn_off: status_led

# Secrets file (create secrets.yaml)
# wifi_ssid: "YourWiFiName"
# wifi_password: "YourWiFiPassword"
# api_password: "your_secure_api_password"
# ota_password: "your_secure_ota_password"